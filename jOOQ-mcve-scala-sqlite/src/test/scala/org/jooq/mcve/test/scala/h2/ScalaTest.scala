package org.jooq.mcve.test.scala.h2

import org.jooq.DSLContext
import org.jooq.impl.DSL
import org.jooq.mcve.scala.sqlite.Tables.TEST
import org.junit.Assert.{assertEquals, assertNotNull}
import org.junit._

import java.sql.{Connection, DriverManager}


class ScalaTest {
  var connection: Connection = null
  var ctx: DSLContext = null

  @Before
  def setup(): Unit = {
    connection = DriverManager.getConnection(s"jdbc:sqlite:${System.getProperty("user.home")}/jooq-mcve-java.sqlite", "sa", "")
    ctx = DSL.using(connection)
    ctx.delete(TEST).execute()
  }

  @After
  def after(): Unit = {
    ctx = null
    connection.close()
    connection = null
  }

  @Test
  def mcveTest(): Unit = {
    assertEquals(1, ctx
      .insertInto(TEST)
      .columns(TEST.CD)
      .values(42)
      .execute()
    )

    val record = ctx.fetchOne(TEST, TEST.CD.eq(42))
    assertNotNull(record.getId)
  }
}
